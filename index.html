<!doctype html>
<html lang="ko">
<head>
  <!-- githubìœ¼ë¡œ í˜¸ìŠ¤íŒ…í•˜ì -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>12ì›” ë²ˆê°œ D-Day ì¹´ìš´í„° â€” 12ì›” 20ì¼ 18:00</title>
  <style>
    :root{--bg:#0b0f14;--card:#0f1720;--accent:#ffd166;--muted:#9aa5b1}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,'Segoe UI',Roboto,'Noto Sans KR',sans-serif;color:#e6eef6;background:radial-gradient(circle at top,#0e1d38 0%,#071021 48%,#05070d 100%);display:flex;align-items:flex-start;justify-content:center;overflow-y:auto;overflow-x:hidden}
    .scene{display:flex;flex-direction:column;align-items:center;gap:24px;position:relative;padding:20px;min-height:100%;width:100%;max-width:100vw;box-sizing:border-box}
    .scene::before{content:"";position:absolute;inset:auto -160px -260px -160px;height:420px;background:radial-gradient(circle,#1d4a7c 0%,rgba(29,74,124,0) 68%);opacity:0.3;pointer-events:none;filter:blur(36px)}

    /* í¸ì§€ ë´‰íˆ¬ */
    .envelope-button{position:relative;width:240px;height:160px;background:linear-gradient(160deg,#fef4d8,#f8d8a9);border:0;border-radius:18px;box-shadow:0 18px 38px rgba(0,0,0,0.38),inset 0 0 0 1px rgba(101,65,32,0.32);cursor:pointer;transition:transform 0.9s cubic-bezier(0.19,1,0.22,1),box-shadow 0.6s ease;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .envelope-button::before{content:"";position:absolute;top:0;left:0;right:0;height:86px;background:linear-gradient(175deg,#f8ddaf,#f2c789);clip-path:polygon(0 0,50% 64%,100% 0);transition:transform 0.9s cubic-bezier(0.19,1,0.22,1);transform-origin:center top}
    .envelope-button::after{content:"";position:absolute;bottom:0;left:0;right:0;height:96px;background:linear-gradient(185deg,#f5d4a1,#f2bf7c);clip-path:polygon(0 100%,0 12%,50% 64%,100% 12%,100% 100%);box-shadow:inset 0 0 0 1px rgba(101,65,32,0.25)}
    .envelope-button:focus-visible{outline:3px solid rgba(255,209,102,0.7);outline-offset:6px}
    .envelope-label{position:relative;z-index:2;font-size:16px;font-weight:600;color:#8b541d;text-shadow:0 1px 0 rgba(255,255,255,0.45);display:flex;align-items:center;gap:8px}
    .envelope-label::before{content:"âœ‰ï¸";font-size:20px}
    .scene.open .envelope-button{transform:translateY(-36px) scale(0.9);box-shadow:0 32px 64px rgba(0,0,0,0.62)}
    .scene.open .envelope-button::before{transform:rotateX(180deg);background:linear-gradient(175deg,#f8d199,#fbdcb4)}

    /* í¸ì§€ ë³¸ë¬¸ */
    .letter{position:relative;width:min(720px,calc(100vw - 48px));max-height:none;overflow:visible;padding:24px;border-radius:18px;background:linear-gradient(180deg,rgba(255,255,255,0.08),rgba(10,16,30,0.68));box-shadow:0 26px 55px rgba(0,0,0,0.6),inset 0 0 0 1px rgba(255,255,255,0.06);transform-origin:top center;transition:opacity 0.7s ease,transform 0.85s cubic-bezier(0.19,1,0.22,1);backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);margin-top:20px}
    .letter::-webkit-scrollbar{width:6px}
    .letter::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.18);border-radius:10px}
    .scene:not(.open) .letter{opacity:0;pointer-events:none;transform:translateY(20px) scale(0.95);max-height:0;overflow:hidden;padding-top:0;padding-bottom:0;margin-top:0}
    .scene.open .letter{opacity:1;pointer-events:auto;transform:translateY(0) scale(1);max-height:none;overflow:visible}

    .wrap{width:100%;max-width:720px;margin:0 auto;padding:28px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.04));border-radius:14px;box-shadow:0 10px 30px rgba(2,6,23,0.55);text-align:center;box-sizing:border-box}
    .letter-close{position:absolute;top:14px;right:18px;padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.2);background:rgba(11,17,28,0.65);color:#f6f7ff;font-size:12px;font-weight:600;letter-spacing:0.4px;cursor:pointer;box-shadow:0 6px 14px rgba(0,0,0,0.35);transition:background 0.2s ease,transform 0.2s ease,opacity 0.3s ease}
    .letter-close:hover{background:rgba(20,32,54,0.8);transform:translateY(-1px)}
    .letter-close:focus-visible{outline:2px solid rgba(255,209,102,0.7)}
    .scene:not(.open) .letter-close{opacity:0;pointer-events:none;transform:translateY(-4px)}
    .envelope-button[aria-disabled="true"]{cursor:default;pointer-events:none;opacity:0.92}
    .invite-form{display:flex;flex-direction:column;gap:12px;align-items:center;text-align:center;color:#dae4f3;margin-top:4px}
    .invite-form label{font-size:14px;color:#f1f2f8;font-weight:600;letter-spacing:0.4px}
    .invite-form .input-row{display:flex;gap:8px;align-items:center;position:relative}
    .invite-input{width:140px;padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,0.28);background:rgba(11,17,28,0.55);color:#f6f7ff;font-size:14px;text-align:center;letter-spacing:0.3px;transition:border 0.2s ease,box-shadow 0.2s ease}
    .invite-input::placeholder{color:rgba(255,255,255,0.45)}
    .invite-input:focus-visible{outline:none;border-color:rgba(255,209,102,0.8);box-shadow:0 0 0 3px rgba(255,209,102,0.25)}
    .invite-submit{padding:10px 18px;border-radius:999px;border:1px solid rgba(255,255,255,0.25);background:linear-gradient(120deg,#ffd166,#ffaf69);color:#241200;font-size:13px;font-weight:700;letter-spacing:0.5px;cursor:pointer;box-shadow:0 8px 18px rgba(0,0,0,0.35);transition:transform 0.2s ease,box-shadow 0.2s ease,opacity 0.2s ease}
    .invite-submit:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(0,0,0,0.4)}
    .invite-submit:focus-visible{outline:2px solid rgba(255,209,102,0.8);outline-offset:3px}
    .invite-hint{margin:0;font-size:12px;color:rgba(233,240,255,0.72)}
    .invite-toast{position:fixed;left:50%;transform:translateX(-50%) translateY(-10px);background:rgba(15,24,42,0.92);color:#fefefe;padding:12px 22px;border-radius:999px;font-size:13px;font-weight:600;letter-spacing:0.4px;box-shadow:0 16px 38px rgba(0,0,0,0.5);opacity:0;pointer-events:none;transition:opacity 0.25s ease,transform 0.35s cubic-bezier(0.22,1,0.36,1);z-index:1001;white-space:nowrap}
    .invite-toast.visible{opacity:1;transform:translateX(-50%) translateY(0)}
    .invite-magic{position:fixed;top:50%;left:50%;z-index:1000;display:flex;gap:10px;align-items:center;justify-content:center;padding:6px 16px;border-radius:999px;background:rgba(22,34,61,0.62);box-shadow:0 12px 24px rgba(0,0,0,0.4);opacity:0;transform:translate(-50%,-50%) scale(0.9);transition:opacity 0.3s ease,transform 0.45s cubic-bezier(0.22,1,0.36,1);pointer-events:none;color:#ffe9b0}
    .invite-magic span{display:inline-block}
    .invite-magic .hat{font-size:30px;animation:hatBounce 1.25s ease-in-out infinite}
    .invite-magic .sparkles{font-size:22px;animation:sparkPulse 0.9s ease-in-out infinite}
    .invite-magic .wand{font-size:26px;animation:wandTwirl 1.25s ease-in-out infinite alternate}
    .invite-magic.active{opacity:1;transform:translate(-50%,-50%) scale(1)}
    @keyframes hatBounce{0%,100%{transform:translateY(0) rotate(-6deg)}50%{transform:translateY(-6px) rotate(4deg)}}
    @keyframes sparkPulse{0%,100%{opacity:0.4;transform:scale(0.88)}50%{opacity:1;transform:scale(1.18)}}
    @keyframes wandTwirl{0%{transform:rotate(-10deg)}100%{transform:rotate(10deg)}}
    h1{margin:0 0 6px;font-size:18px;color:var(--accent)}
    p.sub{margin:0 0 18px;color:var(--muted)}

    /* ì¹´ìš´í„° */
    .counter{display:flex;flex-direction:column;gap:12px;align-items:center}
    .count-badge{font-weight:700;font-size:44px;letter-spacing:2px;background:linear-gradient(90deg,#fff,#ffd166);-webkit-background-clip:text;background-clip:text;color:transparent}
    .time-detail{font-size:14px;color:var(--muted)}

    /* ì¥ì‘ + ë¶ˆ ë””ìì¸ */
    .fire-wrap{position:relative;height:180px;margin-top:18px;display:flex;align-items:flex-end;justify-content:center}
    .logs{position:relative;height:70px;width:420px;display:flex;align-items:center;justify-content:center}
    .log{width:160px;height:34px;border-radius:18px;background:#6b3f1d;box-shadow:inset -6px -6px 14px rgba(0,0,0,0.35), inset 6px 6px 12px rgba(255,255,255,0.02);transform:rotate(-12deg);margin:0 -12px}
    .log.second{transform:rotate(12deg)}
    .bark{position:absolute;inset:0;border-radius:18px;pointer-events:none;background-image:linear-gradient(120deg, rgba(0,0,0,0.08) 0 10%, transparent 10% 20%, rgba(0,0,0,0.06) 20% 30%)}

    /* ë¶ˆê½ƒ - ì—¬ëŸ¬ ë ˆì´ì–´ë¡œ ê°•ë„/ì›€ì§ì„ ì¡°ì ˆ */
    .flame-layer{position:absolute;bottom:62px;width:160px;height:160px;left:50%;transform:translateX(-50%);pointer-events:none;display:flex;align-items:end;justify-content:center}
    .flame{width:44px;height:80px;border-radius:50% 50% 40% 40%/60% 60% 40% 40%;position:relative;filter:blur(0.6px);opacity:0.85}
    .flame::before{content:"";position:absolute;inset:12% 12% 12% 12%;border-radius:inherit}

    /* ìƒ‰ìƒ ë ˆì´ì–´ */
    .flame.red{background:radial-gradient(circle at 30% 30%, rgba(255,120,60,1) 0 28%, rgba(255,90,40,0.9) 35% 60%, rgba(255,40,0,0.6) 70%)}
    .flame.orange{background:radial-gradient(circle at 40% 30%, rgba(255,185,80,1) 0 25%, rgba(255,140,30,0.9) 35% 60%, rgba(255,80,0,0.5) 70%)}
    .flame.yellow{background:radial-gradient(circle at 50% 30%, rgba(255,245,140,1) 0 20%, rgba(255,220,80,0.9) 30% 55%, rgba(255,180,60,0.4) 65%)}

    /* ê¸°ë³¸ ì• ë‹ˆë©”ì´ì…˜ (ì†ë„ì™€ í¬ê¸°ëŠ” JSì—ì„œ ì œì–´) */
    @keyframes flicker {0%{transform:translateY(0) scaleY(1)}50%{transform:translateY(-6%) scaleY(1.06)}100%{transform:translateY(0) scaleY(1)}}

    /* ìƒíƒœ í…ìŠ¤íŠ¸ */
    .status{margin-top:12px;color:var(--muted);font-size:13px}

    /* ì¤€ë¹„ë¬¼ & ë“œë ˆìŠ¤ì½”ë“œ ì•ˆë‚´ */
    .info-block{margin-top:28px;padding:22px;border-radius:16px;background:linear-gradient(135deg,rgba(255,255,255,0.05),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.08);box-shadow:0 12px 28px rgba(4,10,25,0.4);display:flex;flex-direction:column;gap:18px;width:100%;box-sizing:border-box}
    .info-card{text-align:left;background:rgba(7,16,33,0.6);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.06);box-shadow:inset 0 0 18px rgba(255,255,255,0.04)}
    .info-card h2{margin:0 0 10px;font-size:16px;letter-spacing:0.4px;color:#f8f7ff;display:flex;align-items:center;gap:8px}
    .info-card p{margin:0;color:#cfd8e3;font-size:14px;line-height:1.6}
    .info-card a{color:#ffd166;text-decoration:none;border-bottom:1px solid rgba(255,209,102,0.4);padding-bottom:2px;transition:color 0.2s ease,border-color 0.2s ease}
    .info-card a:hover{color:#ffe9a6;border-bottom-color:#ffe9a6}
    .info-card a:focus-visible{outline:2px solid rgba(255,209,102,0.6);border-radius:4px}
    .dresscode-highlight{font-weight:700}
    .dresscode-highlight.red{color:#ff5c6c;text-shadow:0 0 12px rgba(255,92,108,0.4)}
    .dresscode-highlight.green{color:#4dd17a;text-shadow:0 0 12px rgba(77,209,122,0.4)}
    .info-card .sparkle{font-size:18px}
    .invitee-title{color:var(--accent);font-weight:700;letter-spacing:0.5px;margin-right:6px;display:inline-block}

    /* ì¼ì • ì•ˆë‚´ */
    .schedule-block{margin-top:24px;margin-bottom:40px;text-align:left;width:100%;box-sizing:border-box}
    .schedule-details{background:rgba(7,16,33,0.6);border-radius:12px;border:1px solid rgba(255,255,255,0.08);box-shadow:inset 0 0 18px rgba(255,255,255,0.03);width:100%;box-sizing:border-box}
    .schedule-details summary{cursor:pointer;list-style:none;display:flex;align-items:center;gap:10px;padding:16px 18px;font-weight:600;color:#f6f7ff;font-size:15px;position:relative}
    .schedule-details summary::-webkit-details-marker{display:none}
    .schedule-details summary::after{content:"+";margin-left:auto;font-size:18px;color:#ffd166;transition:transform 0.2s ease}
    .schedule-details[open] summary::after{transform:rotate(45deg)}
    .schedule-details summary:focus-visible{outline:2px solid rgba(255,209,102,0.6);border-radius:10px}
    .schedule-content{padding:0 18px 18px;display:flex;flex-direction:column;gap:10px;font-size:14px;color:#cfd8e3}
    .schedule-item{background:rgba(11,17,28,0.7);border-radius:10px;padding:12px 14px;border:1px solid rgba(255,255,255,0.05);display:flex;flex-direction:column;gap:6px}
    .schedule-slot{font-weight:600;color:#ffd166}
    .schedule-desc{margin:0}
    .copyright-note{margin-top:24px;font-size:12px;color:#9aa5b1}

    footer.note{margin-top:18px;color:#9aa5b1;font-size:12px}

    /* ë°˜ì‘í˜• */
    @media (max-width:420px){
      html,body{overflow-y:auto;overflow-x:hidden}
      .scene{padding:16px;gap:20px}
      .envelope-button{width:200px;height:140px}
      .envelope-label{font-size:14px}
      .letter{padding:18px;width:calc(100vw - 32px);margin-top:16px}
      .scene:not(.open) .letter{transform:translateY(10px) scale(0.96)}
      .letter-close{top:10px;right:12px;padding:6px 10px;font-size:11px}
      .wrap{padding:20px}
      .logs{width:300px}
      .log{width:120px;height:30px}
      .flame-layer{bottom:56px}
      .count-badge{font-size:36px}
      .info-block{padding:18px;margin-left:0;margin-right:0}
      .info-card{padding:16px}
      .schedule-block{margin-bottom:32px}
      .schedule-details summary{padding:14px 16px}
      .schedule-content{padding:0 16px 16px}
      .invite-form label{font-size:13px}
      .invite-input{width:120px;padding:8px 12px}
      .invite-submit{padding:8px 14px;font-size:12px}
      .invite-toast{padding:10px 18px;font-size:12px}
      .invite-magic{font-size:22px}
    }
  </style>
</head>
<body>
  <div class="scene" id="scene">
    <button class="envelope-button" id="openEnvelope" type="button" aria-expanded="false" aria-controls="letter-panel" aria-disabled="true">
      <span class="envelope-label">ì´ˆëŒ€ì¥ ì—´ì–´ë³´ê¸°</span>
    </button>
    <form class="invite-form" id="inviteForm" novalidate>
      <label for="inviteName">ì´ë¦„ì„ ì…ë ¥í•´ ì´ˆëŒ€ì¥ì„ ì—´ì–´ë³´ì„¸ìš”</label>
      <div class="input-row">
        <input class="invite-input" id="inviteName" name="inviteName" type="text" maxlength="3" placeholder="ì´ë¦„" autocomplete="off" required>
        <button class="invite-submit" id="inviteSubmit" type="submit">ì—´ì–´ë³´ê¸°</button>
      </div>
      <p class="invite-hint">ì´ˆëŒ€ë°›ì€ ë¶„ë§Œ ì´ˆëŒ€ì¥ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>
    </form>
    <div class="invite-magic" id="inviteMagic" aria-hidden="true">
      <span class="hat" aria-hidden="true">ğŸ§™â€â™‚ï¸</span>
      <span class="sparkles" aria-hidden="true">âœ¨</span>
      <span class="wand" aria-hidden="true">ğŸª„</span>
    </div>

    <div class="letter" id="letter-panel" role="region" aria-label="12ì›” ë²ˆê°œ ì•ˆë‚´" aria-live="polite">
      <button class="letter-close" id="closeEnvelope" type="button">ì´ˆëŒ€ì¥ ë‹«ê¸°</button>
      <div class="wrap" role="application" aria-label="D-Day ì¹´ìš´í„°">
        <h1><span class="invitee-title" id="inviteeTitle"></span> ğŸ“… 12ì›” ë²ˆê°œ D-Day ì•ˆë‚´</h1>
        <p class="invitee-greeting sub" id="inviteeGreeting" style="display:none;"></p>
        <p class="sub">12ì›” 20ì¼ ì˜¤í›„ 6ì‹œ</p>

        <div class="counter">
          <div class="count-badge" id="count">--</div>
          <div class="time-detail" id="detail">ë¡œë”© ì¤‘â€¦</div>
          <div class="status" id="status">ì²˜ìŒì—ëŠ” ì”ë¶ˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤.</div>

          <div class="fire-wrap" aria-hidden="true">
            <div class="flame-layer" id="flameLayer">
              <div class="flame yellow" id="flameY"></div>
              <div class="flame orange" id="flameO" style="margin-left:-10px;margin-right:-10px"></div>
              <div class="flame red" id="flameR"></div>
            </div>
            <div class="logs" aria-hidden="true">
              <div class="log second"><div class="bark"></div></div>
              <div class="log"><div class="bark"></div></div>
            </div>
          </div>
        </div>

        <section class="info-block" aria-label="ì¥ì†Œì™€ ì¤€ë¹„ë¬¼, ë“œë ˆìŠ¤ì½”ë“œ ì•ˆë‚´">
          <article class="info-card">
            <h2>ğŸ“ ì¥ì†Œ</h2>
            <p><a href="https://naver.me/FfeYqfqg" target="_blank" rel="noopener noreferrer">í™ëŒ€ ë£¨í”„íƒ‘ íŒŒí‹°ë£¸ ë¬´ë“œ</a>ì—ì„œ ë§Œë‚˜ìš”.</p>
            <p>ğŸ“« ì„œìš¸ ë§ˆí¬êµ¬ ë…ë§‰ë¡œ9ê¸¸ 8 5ì¸µ</p>
          </article>
          <article class="info-card">
            <h2>ğŸ ì¤€ë¹„ë¬¼</h2>
            <p><span class="sparkle">ğŸ·</span> ê°™ì´ ì¦ê¸¸ ì£¼ë¥˜ ë˜ëŠ” ìŒë£Œë¥¼ í•˜ë‚˜ ì´ìƒ ì±™ê²¨ì™€ ì£¼ì„¸ìš”.</p>
          </article>
          <article class="info-card">
            <h2>ğŸ§£ ë“œë ˆìŠ¤ì½”ë“œ</h2>
            <p><span class="dresscode-highlight red">ë¹¨ê°•</span> ë˜ëŠ” <span class="dresscode-highlight green">ì´ˆë¡ìƒ‰</span> í¬ì¸íŠ¸ë¥¼ ê¼­ ë”í•´ ì£¼ì„¸ìš”! ğŸ„</p>
            <p>ë“œë ˆìŠ¤ì½”ë“œë¥¼ ì§€í‚¤ì§€ ì•Šì€ ë¶„ì€ ë…¸ë˜ ë¶ˆëŸ¬ì£¼ì…”ì•¼í•´ìš”.ğŸ¤ğŸµğŸ§ğŸ’ƒğŸ•ºğŸ¶</p>
          </article>
        </section>

        <section class="schedule-block" aria-label="ëª¨ì„ ì¼ì • ì•ˆë‚´">
          <details class="schedule-details">
            <summary>ğŸ—“ ì¼ì • ì•ˆë‚´</summary>
            <div class="schedule-content">
              <div class="schedule-item">
                <div class="schedule-slot">ì˜¤í›„ 6ì‹œ 30ë¶„ ~ ì˜¤í›„ 8ì‹œ</div>
                <p class="schedule-desc">ì €ë… ì‹ì‚¬ â€” ë”°ëˆí•œ ë¼ì§€ê³ ê¸°ì™€ ì‹ ì„ í•œ íšŒë¥¼ í•¨ê»˜ ì¦ê²¨ìš”.</p>
              </div>
              <div class="schedule-item">
                <div class="schedule-slot">ì˜¤í›„ 8ì‹œ 10ë¶„ ~ ì˜¤í›„ 10ì‹œ</div>
                <p class="schedule-desc">ê°„ë‹¨í•œ ê²Œì„ â€” íŒ€ì„ ë‚˜ëˆ  ì¦ê±°ìš´ ì‹œê°„ ë³´ë‚´ìš”.</p>
              </div>
            </div>
          </details>
        </section>

        <footer class="note">ê¸°íƒ€ ë¬¸ì˜: jays, ì½”ì¸ ë° ì£¼ì‹ ë°›ìŠµë‹ˆë‹¤.</footer>
        <p class="copyright-note">Â© 2025 jays. All left reserved.</p>
      </div>
    </div>
  </div>
  <div class="invite-toast" id="inviteToast" role="alert" aria-live="assertive"></div>

  <script>
    (function(){
      // ëª©í‘œì¼: ë§¤ë…„ 12ì›” 20ì¼ ì˜¤í›„ 18:00 (ë¸Œë¼ìš°ì € ë¡œì»¬ ì‹œê°„)
      function getTargetDate(now){
        const year = now.getFullYear();
        let target = new Date(year, 11, 20, 18, 0, 0, 0); // 11 = December
        if (target <= now) target = new Date(year + 1, 11, 20, 18, 0, 0, 0);
        return target;
      }

      const elCount = document.getElementById('count');
      const elDetail = document.getElementById('detail');
      const elStatus = document.getElementById('status');
      const flameY = document.getElementById('flameY');
      const flameO = document.getElementById('flameO');
      const flameR = document.getElementById('flameR');
      const flameLayer = document.getElementById('flameLayer');

      let startTime = new Date();
      let target = getTargetDate(startTime);
      const fullDuration = target - startTime; // ms

      function formatTwo(n){return String(n).padStart(2,'0');}

      function update(){
        const now = new Date();
        const remaining = target - now;

        if (remaining <= 0){
          elCount.textContent = 'D-DAY';
          elDetail.textContent = 'ì§€ê¸ˆì€ D-Day ì…ë‹ˆë‹¤!';
          elStatus.textContent = 'ğŸ”¥ ë„ì°©í–ˆìŠµë‹ˆë‹¤. ë¶ˆê½ƒì´ ìµœê³ ì¡°ì…ë‹ˆë‹¤!';
          // ìµœëŒ€ ë¶ˆ
          setFlameIntensity(1);
          return;
        }

        const days = Math.ceil(remaining / (24*3600*1000));
        // 24ì‹œê°„ ì´ˆê³¼ì¸ ê²½ìš°: D-<ì¼ìˆ˜> í˜•ì‹ (ë‚ ì§œë§Œ ë°”ë€œ)
        if (remaining > 24*3600*1000){
          elCount.textContent = `D-${days}`;
          elDetail.textContent = `${target.getFullYear()}ë…„ ${target.getMonth()+1}ì›” ${target.getDate()}ì¼ ${formatTwo(target.getHours())}:${formatTwo(target.getMinutes())} ê¸°ì¤€(KST)`;
          elStatus.textContent = '';
        } else {
          // 24ì‹œê°„ ì´í•˜: ì‹œ:ë¶„:ì´ˆ ì‹¤ì‹œê°„ ì¹´ìš´íŠ¸
          const hrs = Math.floor(remaining / (3600*1000));
          const mins = Math.floor((remaining % (3600*1000)) / (60*1000));
          const secs = Math.floor((remaining % (60*1000)) / 1000);
          elCount.textContent = `D-DAY ${formatTwo(hrs)}:${formatTwo(mins)}:${formatTwo(secs)}`;
          elDetail.textContent = `ë‚¨ì€ ì‹œê°„ â€” ${hrs}ì‹œê°„ ${mins}ë¶„ ${secs}ì´ˆ`;
          elStatus.textContent = '24ì‹œê°„ ì´ë‚´ì…ë‹ˆë‹¤. ì´ˆ ë‹¨ìœ„ë¡œ ê°ì†Œí•©ë‹ˆë‹¤.';
        }

        // ë¶ˆê½ƒ ê°•ë„ ê³„ì‚°: í˜ì´ì§€ ë¡œë“œ ì‹œì (startTime)ë¶€í„° ëª©í‘œê¹Œì§€ì˜ ìƒëŒ€ì  ì§„í–‰ë„ë¡œ ì •ì˜
        const elapsed = now - startTime; // ms
        let intensity = 0;
        if (fullDuration > 0){
          intensity = Math.min(Math.max(elapsed / fullDuration, 0), 1);
        }
        setFlameIntensity(intensity);
      }

      // ë¶ˆê½ƒì˜ í¬ê¸°, í”ë“¤ë¦¼ ì†ë„ ë“±ì„ ì¡°ì ˆ
      function setFlameIntensity(t){
        // t: 0 ~ 1
        // í¬ê¸°: 0.45 ~ 1.25
        const baseScale = 0.45 + 0.8 * t;
        flameY.style.transform = `translateY(${ -8 * t }%) scale(${ baseScale * 0.9 })`;
        flameO.style.transform = `translateY(${ -6 * t }%) scale(${ baseScale * 1.0 })`;
        flameR.style.transform = `translateY(${ -4 * t }%) scale(${ baseScale * 1.15 })`;

        // ì• ë‹ˆë©”ì´ì…˜ ì†ë„ ë° í”ë“¤ë¦¼ ì„¸ê¸°: ì‹œê°„ ë‹¨ì¶•
        const speed = 1.8 - 1.3 * t; // 1.8s ~ 0.5s
        const grow = 0.8 + 0.6 * t; // í”ë“¤ë¦¼ í­

        [flameY, flameO, flameR].forEach((el, i)=>{
          el.style.animation = `flicker ${Math.max(0.45, speed - i*0.12)}s ease-in-out infinite`;
          el.style.opacity = 0.45 + 0.55 * t; // ì–´ë‘ìš´ ì”ë¶ˆ -> ë°ì€ ë¶ˆ
          el.style.filter = `blur(${0.6 - 0.45*t}px) saturate(${1 + 0.7*t})`;
        });

        // ë¶ˆ ë ˆì´ì–´ ì „ì²´ ìœ„ì¹˜ ì•½ê°„ ë³€ë™(ì‹œê°ì  ê°•ì¡°)
        flameLayer.style.bottom = `${62 + 18 * t}px`;
      }

      // ì²˜ìŒ ìƒíƒœ: ì”ë¶ˆ(ì•½í•˜ê²Œ). ì• ë‹ˆë©”ì´ì…˜ì„ ì¡°ê¸ˆ ì¤€ë‹¤.
      setFlameIntensity(0.04);
      update();
      // ì—…ë°ì´íŠ¸ ì£¼ê¸°: ì´ˆë‹¨ìœ„ë¡œ, 1ì´ˆë§ˆë‹¤
      const timer = setInterval(update, 1000);

      // ì‚¬ìš©ìì—ê²Œ ì¹œì ˆí•œ í¬ì»¤ìŠ¤/íƒ­ ì ‘ê·¼ì„±
      document.addEventListener('visibilitychange', function(){
        if (!document.hidden){ update(); }
      });

    })();
  </script>
  <script>
    (function(){
      const allowedNames = new Set(['ìš°ì •ì‹',' ê°•ìˆ˜í˜„', 'ì„œë¯¼ê²½', 'ì‹ ì§€ì€', 'í•œì•„ë¦„', 'ì¥ì„±ì„', 'ì •ì€í¬', 'í•œì§€í›ˆ', 'ë°°ì¬ì—´'].map((name)=>name.trim()));
      const scene = document.getElementById('scene');
      const btn = document.getElementById('openEnvelope');
      const letter = document.getElementById('letter-panel');
      const closeBtn = document.getElementById('closeEnvelope');
      const label = btn ? btn.querySelector('.envelope-label') : null;
      const inviteForm = document.getElementById('inviteForm');
      const inviteInput = document.getElementById('inviteName');
      const inviteSubmit = document.getElementById('inviteSubmit');
      const toast = document.getElementById('inviteToast');
      const magic = document.getElementById('inviteMagic');
      const inviteeTitle = document.getElementById('inviteeTitle');
      const inviteeGreeting = document.getElementById('inviteeGreeting');
      let toastTimer = null;
      let processing = false;
      let inviteUnlocked = false;

      if (!scene || !btn || !letter || !inviteForm || !inviteInput || !inviteSubmit) return;

      const motionReduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const openDelay = motionReduce ? 0 : 820;
      const closeDelay = motionReduce ? 0 : 520;
      const verdictDelay = motionReduce ? 0 : 1000;

      letter.setAttribute('tabindex','-1');
      letter.setAttribute('aria-hidden','true');
      btn.setAttribute('aria-disabled','true');
      if (label){ label.textContent = 'ì´ˆëŒ€ì¥ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤.'; }
      if (magic){ magic.setAttribute('aria-hidden','true'); }

      function showToast(message){
        if (!toast || !inviteInput) return;
        toast.textContent = message;
        // input ìœ„ì— í† ìŠ¤íŠ¸ ë°°ì¹˜
        const inputRect = inviteInput.getBoundingClientRect();
        const scrollY = window.scrollY || window.pageYOffset;
        const toastTop = inputRect.top + scrollY - 50; // input ìœ„ 50px
        toast.style.top = `${toastTop}px`;
        toast.classList.add('visible');
        if (toastTimer) clearTimeout(toastTimer);
        toastTimer = setTimeout(()=>{
          toast.classList.remove('visible');
          toastTimer = null;
        }, 3000);
      }

      function clearToast(){
        if (!toast) return;
        toast.classList.remove('visible');
        if (toastTimer){
          clearTimeout(toastTimer);
          toastTimer = null;
        }
      }

      function toggleMagic(show){
        if (!magic) return;
        magic.classList.toggle('active', show);
        magic.setAttribute('aria-hidden', String(!show));
      }

      function finishProcessing(){
        processing = false;
        inviteInput.disabled = false;
        inviteSubmit.disabled = false;
      }

      function setOpenState(open){
        scene.classList.toggle('open', open);
        btn.setAttribute('aria-expanded', String(open));
        letter.setAttribute('aria-hidden', String(!open));
        if (label){ label.textContent = open ? 'ì´ˆëŒ€ì¥ ì ‘ì–´ë‘ê¸°' : 'ì´ˆëŒ€ì¥ ì—´ì–´ë³´ê¸°'; }
        if (open){ clearToast(); }

        const fallbackFocus = inviteUnlocked ? btn : inviteInput;
        const focusTarget = open ? letter : fallbackFocus;
        const delay = open ? openDelay : closeDelay;
        if (delay === 0){
          focusTarget.focus({preventScroll:true});
        } else {
          setTimeout(()=>focusTarget.focus({preventScroll:true}), delay);
        }
      }

      inviteInput.addEventListener('input', ()=>clearToast());

      inviteForm.addEventListener('submit', (event)=>{
        event.preventDefault();
        if (processing) return;

        const name = inviteInput.value.trim();
        if (!name){
          showToast('ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
          inviteInput.focus({preventScroll:true});
          return;
        }

        if (name.length > 3){
          showToast('ì´ë¦„ì€ ìµœëŒ€ 3ê¸€ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
          inviteInput.focus({preventScroll:true});
          return;
        }

        processing = true;
        inviteInput.disabled = true;
        inviteSubmit.disabled = true;
        btn.setAttribute('aria-disabled','true');
        clearToast();
        toggleMagic(true);

        const completeCheck = ()=>{
          toggleMagic(false);
          finishProcessing();
          const randMessage = ['ê¸°ë‹¤ë ¸ì–´ìš”!', 'ë°˜ê°‘ìŠµë‹ˆë‹¤!', 'ì¦ê±°ìš´ ì‹œê°„ì´ ë˜ì‹œê¸¸ ë°”ë„ê²Œìš”!', 'ë²ˆê°œë¥¼ ì¦ê²¨ì£¼ì„¸ìš”!', 'ì •ì‹ë‹˜ì€ ì§„ì§œ ë©‹ì ¸ìš”!'];

          if (allowedNames.has(name)){
            inviteUnlocked = true;
            btn.removeAttribute('aria-disabled');
            if (inviteeTitle){
              inviteeTitle.textContent = `${name}ë‹˜ì„ ìœ„í•œ`;
            }
            if (inviteeGreeting){
              inviteeGreeting.textContent = `${name}ë‹˜, ${randMessage[Math.floor(Math.random() * randMessage.length)]}`;
              inviteeGreeting.style.display = 'block';
            }
            if (!scene.classList.contains('open')){
              setOpenState(true);
            }
          } else {
            showToast('ì´ˆëŒ€ë°›ì§€ ì•Šì€ ë¶„ì€ ì—¬ì‹¤ ìˆ˜ ì—†ì–´ìš”.');
            inviteInput.focus({preventScroll:true});
          }
        };

        if (verdictDelay === 0){
          completeCheck();
        } else {
          setTimeout(completeCheck, verdictDelay);
        }
      });

      btn.addEventListener('click', ()=>{
        if (btn.getAttribute('aria-disabled') === 'true' || processing) return;
        const nextState = !scene.classList.contains('open');
        setOpenState(nextState);
      });

      if (closeBtn){
        closeBtn.addEventListener('click', ()=>{
          if (processing) return;
          setOpenState(false);
        });
      }

      letter.addEventListener('keydown', (event)=>{
        if (event.key === 'Escape' && !processing){
          event.preventDefault();
          setOpenState(false);
        }
      });
    })();
  </script>
</body>
</html>
